on: push
name: packtracker.io
jobs:
  report:
    name: report webpack stats
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
      with:
            fetch-depth: 2 # So packtracker can get the previous commit

    - name: Cache node_modules
      uses: actions/cache@v2
      env:
        cache-name: cache-node_modules
      with:
        path: node_modules
        key: ${{ runner.os }}-${{ env.cache-name }}-${{ hashFiles('yarn.lock')}}
        restore-keys: |
          ${{ runner.os }}-${{ env.cache-name }}-${{ hashFiles('yarn.lock')}}
          ${{ runner.os }}-${{ env.cache-name }}-

    - name: Get yarn cache directory path
      id: yarn-cache-dir-path
      run: echo "::set-output name=dir::$(yarn cache dir)"

    - name: Cache yarn
      uses: actions/cache@v2
      env:
        cache-name: cache-yarn
      with:
        path: ${{ steps.yarn-cache-dir-path.outputs.dir }}
        key: ${{ runner.os }}-${{ env.cache-name }}-${{ hashFiles('yarn.lock') }}
        restore-keys: |
          ${{ runner.os }}-${{ env.cache-name }}-${{ hashFiles('yarn.lock') }}
          ${{ runner.os }}-${{ env.cache-name }}-

    - name: Install
      run: yarn install --frozen-lockfile --prefer-offline

    - name: report webpack stats
      uses: packtracker/report@2.3.0
      env:
        PT_PROJECT_TOKEN: ${{ secrets.PT_PROJECT_TOKEN }}
        WEBPACK_CONFIG_PATH: ./config/webpack.js
